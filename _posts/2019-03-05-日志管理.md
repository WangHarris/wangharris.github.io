---
layout: post
title: "日志管理"
date: 2019-03-05
excerpt: ""
tags: [linux]
comments: true
---







1. 常见日志的作用

   | 日志文件         | 说明                                                         |
   | ---------------- | ------------------------------------------------------------ |
   | /var/log/cron    | 记录了系统定时任务相关的日志。                               |
   | /var/log/cups/   | 记录了打印信息的日志。                                       |
   | /var/log/dmesg   | 记录了系统在开机时内核自检的信息。                           |
   | /var/log/btmp    | 记录错误登录的日志。这个文件是二进制文件，需要使用lastb命令查看。 |
   | /var/log/lastlog | 记录系统中所有用户最后一次的登录时间的日志。这个文件也是二进制文件，需要使用lastlog命令查看。 |
   | /var/log/message | 记录系统重要信息的日志。这个文件中会记录系统的绝大多数重要信息，如果系统出现问题时，首先要检查的应该是这个日志文件。 |
   | /var/log/secure  | 记录验证和授权方面的信息，只要涉及账户和密码的程序都会记录。比如说系统的登录，ssh的登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个文件中。 |
   | /var/log/wtmp    | 永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。这个文件也是一个二进制文件，需要使用last命令查看。 |
   | /var/log/mailog  | 记录邮件信息。                                               |

   

2. rsyslogd日志服务

   - 日志文件格式

     基本日志格式包含以下四列：

     - 事件产生的时间
     - 发生事件的服务器的主机名
     - 产生事件的服务名或程序名
     - 事件的具体信息

   - /etc/rsyslog.conf配置文件

     主要用来配置什么服务的什么日志等级的日志记录在什么位置。

3. 日志轮替

   - 日志文件的命名规则

     ​	如果配置文件中拥有“dateext”参数，那么日志会用日期来作为日志文件的后缀，例如“secure-20130605” 。这样的话日志文件名不会重叠，所以也就不需要日志文件的改名，只需要保存指定的日志个数，删除多余的日志文件即可。

   - /etc/logrotate.conf配置文件

     | 参数                    | 说明                                                         |
     | ----------------------- | ------------------------------------------------------------ |
     | daily                   | 日志的轮替周期是每天                                         |
     | weekly                  | 日志的轮替周期是每周                                         |
     | monthly                 | 日志的轮替周期是每月                                         |
     | rotate 数字             | 保留的日志文件个数。0指没有备份                              |
     | compress                | 日志轮替时，旧的日志进行压缩                                 |
     | create mode owner group | 建立新日志，同时指定新日志的权限与所有者和所属组。如：create 0600 root utmp |
     | minsize 大小            | 日志轮替的最小值。也就是日志一定要达到这个最小值才会轮替，否则就算时间达到也不轮替。 |
     | size 大小               | 日志只有大于指定大小才进行日志轮替么不是按照时间轮替。如：size 100k |
     | dateext                 | 使用日期作为日志轮替文件的后缀。如：secure-20130605          |

     